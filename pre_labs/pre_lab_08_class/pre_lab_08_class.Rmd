---
title: "pre_lab_08.Rmd"
author: "Derek Willis"
date: "2023-03-30"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Chapter 26

Visualizing data is becoming a much greater part of journalism. Large news organizations are creating graphics desks that create complex visuals with data to inform the public about important events.

To do it well is a course on its own. And not every story needs a feat of programming and art. Sometimes, you can help yourself and your story by just creating a quick chart, which helps you see patterns in the data that wouldn't otherwise surface.

Good news: one of the best libraries for visualizing data is in the tidyverse and it's pretty simple to make simple charts quickly with just a little bit of code. It's called [ggplot2](https://ggplot2.tidyverse.org/).

Let's revisit some data we've used in the past and turn it into charts. First, let's load libraries. When we load the tidyverse, we get ggplot2.

### Task 1: Load packages

**Task** Run the following code to load packages.

```{r}
library(tidyverse)
library(lubridate)
```

The dataset we'll use is 911 overdose calls from Baltimore County. Let's load it.

### Task 2: Load data

**Task** Run the following code to load the data. In the space below, indicate how many rows and columns it has. **Answer**

```{r}
baltco_911_calls <- read_csv("data/baltco_911_calls.csv")
```

## Bar charts

The first kind of chart we'll create is a simple bar chart.

It's a chart designed to show differences between things -- the magnitude of one thing, compared to the next thing, and the next, and the next.

So if we have thing, like a county, or a month, or a day of the week, and then a count of that group, we can make a bar chart.

So what does the chart of the top months with the most 911 overdose calls look like?

First, we'll add a month column to our dataframe using lubridate.

### Task 3: Add a month column to our 911 calls dataframe using lubridate and calculate the number of calls for each month

**Task** Run the following code to add a month column to our dataframe using lubridate and count the number of calls for each month. In the space below, explain what each step of the code below is doing in English. Note the "label=TRUE" part in the mutate statement. **Answer** It's adding a month column but using a label function to display in abbreviated text form instead of number form.

```{r}
baltco_911_calls_by_month <- baltco_911_calls |>
  mutate(month = month(date, label=TRUE)) |> 
  group_by(month) |> 
  summarize(total_calls = n()) |> 
  arrange(desc(total_calls))

baltco_911_calls_by_month
```

Now let's create a bar chart using ggplot.

With ggplot, the first thing we'll always do is draw a blank canvas that will contain our chart. We start with our dataframe name, and then (\|\>) we invoke the ggplot() function to make that blank canvas. All this does is make a gray box, the blank canvas that will hold our chart.

### Task 4: Create a bar chart

**Task** Run the following code. Explain what you see after running the code in the space below. **Answer** A chart of the table we made in previous step, ordered by month and total calls. 

```{r}
baltco_911_calls_by_month |>
  ggplot() +
  geom_bar(aes(x=reorder(month,total_calls), weight=total_calls))
```

### Task 5: Run the following code

**Task** Run the following code. Explain what you see after running the code in the space below. What has changed from the last codeblock? **Answer** Flipped the y and x axes with "coord_flip".

```{r}

baltco_911_calls_by_month_bar <- baltco_911_calls_by_month |>
  ggplot() +
  geom_bar(aes(x=reorder(month,total_calls), weight=total_calls)) +
  coord_flip()

baltco_911_calls_by_month_bar
```

### Task 6: Run the following code

**Task** Run the following code. What do you think this does? **Answer** Saved a png of the chart, and set the width and height ratio of the chart.

```{r}
ggsave('baltco_911_calls_by_month_bar.png', plot = baltco_911_calls_by_month_bar, width = 16, height = 8)
```

## Line charts

Let's look at how to make another common chart type that will help you understand patterns in your data.

Line charts can show change over time. It works much the same as a bar chart, code wise, but instead of a weight, it uses a y.

So, let's use the same Baltimore County data and generate a count of contributions for each date in our data.

### Task 7: Create a dataframe of 911 calls by date

**Task** Run the following code. Explain what you see after running the code in the space below. **Answer** A table of calls by date.

```{r}
baltco_911_calls_by_date <- baltco_911_calls |>
  group_by(date) |>
  summarise(
    total_calls=n()
  )

baltco_911_calls_by_date
```

And now let's make a line chart to look for patterns in this data.

We'll put the date on the x axis and total contributions on the y axis.

### Task 8: Run the following code

**Task** Run the following code. Explain what you see after running the code in the space below. **Answer** A plot of the call trends, with lots of spikes.

```{r}
baltco_911_calls_by_date |>
  ggplot() + 
  geom_line(aes(x=date, y=total_calls))
```

It's not super pretty, but there's a bit of a pattern here: the number of calls fluctuates between 5 and 20 a day for most of this period, and then jumps way up at certain points during the year. In particular there are spikes in July, early October and January.

Right now, it's kind of hard to see specifics, though. When did some of those smaller spikes and troughs happen?

We can't really tell. So let's modify the x axis to have one tick mark and label per month. We can do that with a function called scale_x_date().

We'll set the date_breaks to appear for every week; if we wanted every month, we'd say date_breaks = "1 month". We can set the date to appear as month abbreviated name (%b) and day (%d).

### Task 9: Run the following code

**Task** Run the following code. Explain what you see after running the code in the space below. **Answer** Dates broken by week instead of day, so less chaotic.

```{r}
baltco_911_calls_by_date |>
  ggplot() + 
  geom_line(aes(x=date, y=total_calls)) + 
  scale_x_date(date_breaks = "1 week", date_labels = "%b %d")
```

Those are a little hard to read, so we can turn them 45 degrees to remove the overlap using the theme() function for styling. With "axis.text.x = element_text(angle = 45, hjust=1)" we're saying, turn the date labels 45 degrees.

### Task 10: Run the following code

**Task** Run the following code. Explain what you see after running the code in the space below. **Answer** The labels are angled, so slightly more readable, but still kind of a mess.

```{r}
baltco_911_calls_by_date |>
  ggplot() + 
  geom_line(aes(x=date, y=total_calls)) + 
  scale_x_date(date_breaks = "1 week", date_labels = "%b %d") +
  theme(
    axis.text.x = element_text(angle = 60,  hjust=1)
  )
```

Again, this isn't as pretty as we could make it. But by charting this, we can quickly see some outliers that could guide our reporting.

We're just scratching the surface of what ggplot can do, and chart types. There's so much more you can do, so many other chart types you can make. But the basics we've shown here will get you started.
